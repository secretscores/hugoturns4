<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <title>üéÉHappy Halloween Birthdayüßü</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Creepster&display=swap" rel="stylesheet">
  <style>
    :root{
      --dark-bg:#10001D; --accent-purple:#9D3CFF; --accent-orange:#FF8C00;
      --text-color:#E0E0E0;
      --font-main:'Montserrat',sans-serif; --font-title:'Creepster',cursive;
      --frame-pad: 20px;
      --base-w: 380px;
      --base-h: 680px;
      --pad-x: 36px;
      --pad-y: 44px;
    }

    html, body { height: 100%; margin:0; }

    body{
      font-family:var(--font-main); color:var(--text-color); background-color:var(--dark-bg);
      overflow:hidden; min-height:100svh;
      background-image:
        radial-gradient(#2a0045 40%,transparent 40%),
        radial-gradient(#2a0045 20%,transparent 20%);
      background-size:5px 5px; background-position:0 0, 10px 10px;
      padding: max(var(--frame-pad), env(safe-area-inset-top))
               max(var(--frame-pad), env(safe-area-inset-right))
               max(var(--frame-pad), env(safe-area-inset-bottom))
               max(var(--frame-pad), env(safe-area-inset-left));
    }
    @supports (min-height: 100dvh) { body { min-height: 100dvh; } }

    #welcome-screen{
      position:fixed; inset:0; background-color:var(--dark-bg);
      display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000;
      cursor:pointer; transition:opacity .5s ease-out;
    }
    .portal-text{
      font-family:var(--font-title); font-size:3em; font-weight:700; color:var(--accent-orange);
      margin-bottom:20px; line-height:1.1; text-align:center;
    }
    .portal-img{
      max-width:280px; width:80%; height:auto; margin:15px auto; display:block;
      filter:drop-shadow(0 0 20px rgba(255,140,0,.6));
    }
    .neon-flicker { font-weight:700; color:var(--accent-purple); animation:flicker-purple 1.5s infinite alternate; }

    .card-stage{
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
    }
    .card-frame{
      width: var(--base-w);
      height: var(--base-h);
      padding: calc(var(--pad-y)/2) calc(var(--pad-x)/2);
      transform-origin:center center;
      will-change: transform;
    }

    .invitation-card{
      width:100%; height:100%;
      background:
        linear-gradient(145deg, rgba(0,0,0,0.70), rgba(0,0,0,0.70)),
        url('woodyterr.webp'),
        url('background1.webp');
      background-size: cover, cover, cover;
      background-position: center, center, center;
      border-radius:30px;
      box-shadow:0 15px 50px rgba(0,0,0,.7), 0 0 25px var(--accent-purple);
      padding:30px 20px;
      box-sizing:border-box;
      text-align:center;
      position:relative;
      z-index:50;
      opacity:0;
      transform: rotateY(-15deg);
      transition:opacity 1s ease-out, transform 1s ease-out;
      overflow:hidden;
    }
    .show-card{ opacity:1 !important; transform: rotateY(0deg) !important; }

    /* Barrido cada 5s */
    .woody-backlight{
      position:absolute; inset:0; border-radius:30px; pointer-events:none;
      z-index:1;
      mix-blend-mode:screen;
      opacity:0;
      filter: blur(10px) saturate(1.08);
      background:
        radial-gradient(95% 150% at 112% 50%, rgba(255,235,190,0.00) 42%, rgba(255,235,190,0.50) 56%, rgba(255,235,190,0.00) 70%),
        radial-gradient(80% 120% at 105% 95%, rgba(255,210,150,0.00) 38%, rgba(255,210,150,0.35) 55%, rgba(255,210,150,0.00) 72%);
      background-size: 220% 100%, 200% 100%;
      background-position: 10% 0, -10% 0;
      -webkit-mask-image: url('woodyterr.webp');
      mask-image: url('woodyterr.webp');
      -webkit-mask-size: cover; mask-size: cover;
      -webkit-mask-position: center; mask-position:center;
      -webkit-mask-repeat:no-repeat; mask-repeat:no-repeat;
    }
    .invitation-card.sweep .woody-backlight{
      animation: headlightShort 1.1s ease-out forwards;
    }
    @keyframes headlightShort{
      0%   { opacity:.85; background-position: 10% 0, -10% 0; }
      60%  { opacity:.55; }
      100% { opacity:0;  background-position: 60% 0, -60% 0; }
    }

    h1{
      font-family:var(--font-title); font-size:3.5em; color:var(--accent-orange);
      margin:0 0 15px; line-height:1.1; transform:scale(.9);
      animation:title-pop .8s ease-out forwards; font-weight:900;
      position:relative; z-index:2;
    }
    h2{ font-size:1.2em; font-weight:700; color:var(--accent-purple); margin:10px 0 25px; text-transform:uppercase; letter-spacing:2px; position:relative; z-index:2; }
    p{ font-size:1em; margin:15px 0; line-height:1.5; color:var(--text-color); position:relative; z-index:2; }

    .data-panel{
      background-color:rgba(0,0,0,.23); border:1px solid var(--accent-purple); border-radius:10px;
      padding:20px 10px; margin:30px 0; box-shadow:0 0 15px rgba(157,60,255,.25); text-align:left;
      position:relative; z-index:2;
    }
    .data-panel p{ display:flex; justify-content:space-between; align-items:center; padding:5px 15px;
      border-bottom:1px dashed rgba(255,255,255,.1); font-weight:700; }
    .data-panel p:last-child{ border-bottom:none; }
    .data-panel span{ font-weight:900; color:var(--accent-orange); text-shadow:0 0 5px rgba(255,140,0,.5); }

    .location-button{
      display:block; margin:30px auto; padding:18px 30px;
      background:var(--accent-orange); color:#fff; text-decoration:none; font-weight:900;
      border-radius:50px; text-transform:uppercase; letter-spacing:1px; transition:all .3s ease;
      position:relative; overflow:hidden; border:none; animation:button-flicker 1.5s infinite alternate;
      z-index:2;
    }
    .location-button:hover{ background:var(--accent-orange); color:#fff; box-shadow:0 0 25px var(--accent-orange); transform:scale(1.05); }

    /* Efectos flotantes */
    .effect-item{
      position:absolute; font-size:3em; opacity:.5; pointer-events:none; animation:float-and-sway 15s linear infinite;
      filter:drop-shadow(0 0 5px rgba(255,255,255,.5)); z-index:9999;
    }
    .effect-item.bat1{
      bottom:38%; left:26%;
      animation-duration:7s;
      color:var(--accent-orange);
    }
    .effect-item img{ width:1.8em; height:1.8em; display:block; object-fit:contain; pointer-events:none; }

    @keyframes title-pop{0%{opacity:0;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
    @keyframes float-and-sway{
      0%{transform:translate(0,0) rotate(0deg); opacity:0}
      20%{opacity:.7}
      50%{transform:translate(10px,-20px) rotate(5deg); opacity:.9}
      80%{opacity:.7}
      100%{transform:translate(0,0) rotate(0deg); opacity:0}
    }
    @keyframes flicker-purple {
      0%,18%,22%,25%,53%,57%,100% {
        opacity:1;
        text-shadow:
          0 0 8px rgba(157,60,255,0.9),
          0 0 16px rgba(157,60,255,0.7),
          0 0 28px rgba(157,60,255,0.5);
      }
      20%,24%,55% { opacity:.6; text-shadow:none; }
    }
    @keyframes button-flicker {
      0%, 18%, 22%, 25%, 53%, 57%, 100% {
        box-shadow:
          0 0 8px rgba(255,140,0,0.9),
          0 0 16px rgba(255,140,0,0.7),
          0 0 28px rgba(255,140,0,0.5);
        background: var(--accent-orange);
      }
      20%, 24%, 55% { box-shadow: none; background: rgba(255,140,0,0.6); }
    }
  </style>
</head>
<body>
  <div id="welcome-screen">
    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <img src="happyhw1.webp" alt="Happy Halloween" class="portal-img">
    <p class="small-instruction neon-flicker" style="margin-top:50px;">Toca la pantalla...</p>
  </div>

  <div class="card-stage">
    <div class="card-frame" id="card-frame">
      <div class="invitation-card" id="invitation-card-content">
        <div class="woody-backlight" aria-hidden="true"></div>

        <span class="effect-item bat1"><img src="iconpic1.webp" alt=""></span>

        <h1 class="portal-text">HUGO TURNS 4!</h1>
        <h2>Happy Halloween Birthday</h2>
        <p>¬°Acomp√°√±anos a celebrar el cumple n√∫mero 4 de Hugo, te esperamos!</p>

        <div class="data-panel">
          <p>FECHA: <span>üéÉ 30 DE OCTUBRE</span></p>
          <p>HORA:  <span>üï∞Ô∏è 04:00 PM</span></p>
          <p>NOTA:  <span>üëª Trae tu Disfraz</span></p>
          <p>LUGAR: <span>üó∫Ô∏è Privada Los Reyes,<br>Portal de Hierro</span></p>
        </div>

        <a id="map-link" href="#" class="location-button" target="_blank">UBICACI√ìN</a>
        <p style="font-size:.9em; color:var(--accent-purple);">Buuu!</p>
      </div>
    </div>
  </div>

  <audio id="bgm" src="HalloweenWaltzz.mp3" preload="auto" loop></audio>

  <script>
    const LATITUD = 25.757046;
    const LONGITUD = -109.023735;
    const LUGAR_FIESTA = "Fiesta de Hugo";
    function createMapLink(lat, lng, label){
      const isApple = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      return isApple
        ? `http://maps.apple.com/?ll=${lat},${lng}&q=${encodeURIComponent(label)}&z=15`
        : `https://www.google.com/maps/search/?api=1&query=${lat},${lng}&query_place_id=${encodeURIComponent(label)}`;
    }
    document.getElementById('map-link').href = createMapLink(LATITUD, LONGITUD, LUGAR_FIESTA);

    const welcomeScreen = document.getElementById('welcome-screen');
    const invitationCardContent = document.getElementById('invitation-card-content');
    const bgm = document.getElementById('bgm');

    function fadeInAudio(target = 0.85, ms = 800){
      try { const steps = 16, stepTime = ms/steps; let v = 0; bgm.volume = 0;
        const id = setInterval(()=>{ v += target/steps; bgm.volume = Math.min(v, target); if (v >= target) clearInterval(id); }, stepTime);
      } catch(e){}
    }
    let musicStarted = false;
    async function startMusicFrom10s(){
      try{
        const seekAndPlay = async () => { try { bgm.currentTime = 10; } catch(e) {} await bgm.play(); fadeInAudio(0.85, 900); musicStarted = true; };
        if (bgm.readyState >= 1){ await seekAndPlay(); }
        else{
          bgm.addEventListener('loadedmetadata', async function onMeta(){ bgm.removeEventListener('loadedmetadata', onMeta); await seekAndPlay(); });
          bgm.addEventListener('canplay', async function onCan(){ bgm.removeEventListener('canplay', onCan); if (!musicStarted) await seekAndPlay(); });
        }
      }catch(err){ try { await bgm.play(); } catch(e){} }
    }

    const frame = document.getElementById('card-frame');
    function cssNum(v){ return parseFloat(getComputedStyle(document.documentElement).getPropertyValue(v)); }
    function viewport(){
      const vv = window.visualViewport;
      const vw = Math.min(window.innerWidth, document.documentElement.clientWidth || window.innerWidth);
      const vh = vv ? vv.height : Math.min(window.innerHeight, document.documentElement.clientHeight || window.innerHeight);
      return { vw, vh };
    }
    function fitCard(){
      const baseW = cssNum('--base-w');
      const baseH = cssNum('--base-h');
      const padX  = cssNum('--pad-x');
      const padY  = cssNum('--pad-y');
      const targetW = baseW + padX;
      const targetH = baseH + padY;
      frame.style.width  = baseW + 'px';
      frame.style.height = baseH + 'px';
      frame.style.transform = 'scale(1)';
      const { vw, vh } = viewport();
      const outer = 2 * (parseFloat(getComputedStyle(document.body).getPropertyValue('padding-left')) || 20);
      const availW = vw - outer;
      const availH = vh - outer;
      const scale = Math.min(availW/targetW, availH/targetH, 1);
      frame.style.transform = `translateZ(0) scale(${scale})`;
    }
    window.addEventListener('resize', fitCard);
    window.visualViewport && window.visualViewport.addEventListener('resize', fitCard);
    window.addEventListener('orientationchange', fitCard);
    window.addEventListener('load', fitCard);

    function startSweepEvery5s(){
      const card = invitationCardContent;
      if (window.__sweepTimer) clearInterval(window.__sweepTimer);
      const run = () => { card.classList.add('sweep'); };
      card.addEventListener('animationend', (e) => {
        if (e.animationName === 'headlightShort') {
          card.classList.remove('sweep');
        }
      });
      run();
      window.__sweepTimer = setInterval(run, 5000);
    }

    welcomeScreen.addEventListener('click', async ()=>{
      welcomeScreen.style.opacity = '0';
      invitationCardContent.classList.add('show-card');
      setTimeout(()=>welcomeScreen.style.display='none', 500);
      await startMusicFrom10s();
      startSweepEvery5s();
      setTimeout(fitCard, 50);
    }, { passive:true });

    document.addEventListener('visibilitychange', async ()=>{
      if (!document.hidden){
        try { await bgm.play(); } catch(e){}
        fitCard();
      }
    });
  </script>
</body>
</html>
