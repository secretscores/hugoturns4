<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üéÉHappy Halloween Birthdayüßü</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Creepster&display=swap" rel="stylesheet">
  <style>
    :root{
      --dark-bg:#10001D; --accent-purple:#9D3CFF; --accent-orange:#FF8C00; --accent-purple:#9D3CFF;
      --text-color:#E0E0E0;
      --font-main:'Montserrat',sans-serif; --font-title:'Creepster',cursive;
    }
    body{
      font-family:var(--font-main); color:var(--text-color); background-color:var(--dark-bg);
      margin:0; padding:0; display:flex; justify-content:center; align-items:center; min-height:100vh;
      overflow:hidden; position:relative;
      background-image:radial-gradient(#2a0045 40%,transparent 40%), radial-gradient(#2a0045 20%,transparent 20%);
      background-size:5px 5px; background-position:0 0, 10px 10px;
    }
    #welcome-screen{
      position:fixed; inset:0; background-color:var(--dark-bg);
      display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000;
      cursor:pointer; transition:opacity .5s ease-out;
    }
    .portal-text{
      font-family:var(--font-title);
      font-size:3em;
      font-weight:700;
      color:var(--accent-orange);
      margin-bottom:20px;
      line-height:1.1;
    }
    .portal-img{
      max-width:280px;
      width:80%;
      height:auto;
      margin:15px auto;
      display:block;
      filter:drop-shadow(0 0 20px rgba(255,140,0,.6));
    }

    /* Tarjeta con doble imagen de fondo + filtro sombr√≠o */
    .invitation-card{
      width:90%; max-width:380px; min-height:600px;
      background:
        linear-gradient(145deg, rgba(0,0,0,0.70), rgba(0,0,0,0.70)),
        url('woodyterr.webp'),
        url('background1.webp');
      background-size: cover, cover, cover;
      background-position: center, center, center;
      background-repeat: no-repeat, no-repeat, no-repeat;
      border-radius:30px;
      box-shadow:0 15px 50px rgba(0,0,0,.7), 0 0 25px var(--accent-purple);
      padding:30px 20px;
      box-sizing:border-box;
      text-align:center;
      position:relative;
      z-index:50;
      opacity:0;
      transform:scale(.8) rotateY(-15deg);
      transition:opacity 1s ease-out, transform 1s ease-out;
    }

    .neon-flicker {
      font-weight:700;
      color:var(--accent-purple);
      animation:flicker-purple 1.5s infinite alternate;
    }

    h1{
      font-family:var(--font-title); font-size:3.5em; color:var(--accent-orange);
      margin-bottom:15px; line-height:1.1; transform:scale(.9); animation:title-pop .8s ease-out forwards; font-weight:900;
    }
    @keyframes title-pop{0%{opacity:0;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
    h2{ font-size:1.2em; font-weight:700; color:var(--accent-purple); margin:10px 0 25px; text-transform:uppercase; letter-spacing:2px; }
    p{ font-size:1em; margin:15px 0; line-height:1.5; color:var(--text-color); }

    .data-panel{
      background-color:rgba(0,0,0,.23); border:1px solid var(--accent-purple); border-radius:10px;
      padding:20px 10px; margin:30px 0; box-shadow:0 0 15px rgba(157,60,255,.25); text-align:left;
    }
    .data-panel p{ display:flex; justify-content:space-between; align-items:center; padding:5px 15px;
      border-bottom:1px dashed rgba(255,255,255,.1); font-weight:700; }
    .data-panel p:last-child{ border-bottom:none; }
    .data-panel span{ font-weight:900; color:var(--accent-orange); text-shadow:0 0 5px rgba(255,140,0,.5); }

    .location-button{
      display:block;
      margin:30px auto;
      padding:18px 30px;
      background:var(--accent-orange);
      color:#fff;
      text-decoration:none;
      font-weight:900;
      border-radius:50px;
      text-transform:uppercase;
      letter-spacing:1px;
      transition:all .3s ease;
      position:relative;
      overflow:hidden;
      border:none;
      animation:button-flicker 1.5s infinite alternate;
    }
    .location-button:hover{ background:var(--accent-orange); color:#fff; box-shadow:0 0 25px var(--accent-orange); transform:scale(1.05); }

    .effect-item{
      position:absolute; font-size:3em; opacity:.5; pointer-events:none; animation:float-and-sway 15s linear infinite;
      filter:drop-shadow(0 0 5px rgba(255,255,255,.5)); z-index:9999;
    }
    .effect-item:nth-child(1){ bottom:38%; left:26%; animation-duration:7s; color:var(--accent-orange); }

    @keyframes float-and-sway{
      0%{transform:translate(0,0) rotate(0deg); opacity:0}
      20%{opacity:.7}
      50%{transform:translate(10px,-20px) rotate(5deg); opacity:.9}
      80%{opacity:.7}
      100%{transform:translate(0,0) rotate(0deg); opacity:0}
    }

    @keyframes flicker-purple {
      0%,18%,22%,25%,53%,57%,100% {
        opacity:1;
        text-shadow:
          0 0 8px rgba(157,60,255,0.9),
          0 0 16px rgba(157,60,255,0.7),
          0 0 28px rgba(157,60,255,0.5);
      }
      20%,24%,55% {
        opacity:.6;
        text-shadow:none;
      }
    }

    @keyframes button-flicker {
      0%, 18%, 22%, 25%, 53%, 57%, 100% {
        box-shadow:
          0 0 8px rgba(255,140,0,0.9),
          0 0 16px rgba(255,140,0,0.7),
          0 0 28px rgba(255,140,0,0.5);
        background: var(--accent-orange);
      }
      20%, 24%, 55% {
        box-shadow: none;
        background: rgba(255,140,0,0.6);
      }
    }

    .show-card{ opacity:1 !important; transform:scale(1) rotateY(0deg) !important; }

    /* Tama√±o de las PNG dentro de los spans de efecto */
    .effect-item img{
      width: 1.8em;
      height: 1.8em;
      display: block;
      object-fit: contain;
      pointer-events: none;
    }
    .effect-item:nth-of-type(1) img { transform: rotate(10deg); }
    .effect-item:nth-of-type(4) img { transform: rotate(15deg); }
  </style>
</head>
<body>
  <div id="welcome-screen">
    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <img src="happyhw1.webp" alt="Happy Halloween" class="portal-img">
    <p class="small-instruction neon-flicker" style="margin-top:50px;">Toca la pantalla...</p>
  </div>

  <!-- Tarjeta -->
  <div class="invitation-card" id="invitation-card-content">
    <span class="effect-item"><img src="iconpic1.webp" alt=""></span>

    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <h2>Happy Halloween Birthday</h2>
    <p>¬°Acomp√°√±anos a celebrar el cumple n√∫mero 4 de Hugo, te esperamos!</p>

    <div class="data-panel">
      <p>FECHA: <span>üéÉ 30 DE OCTUBRE</span></p>
      <p>HORA: <span>üï∞Ô∏è 04:00 PM</span></p>
      <p>NOTA: <span>üëª Trae tu Disfraz</span></p>
      <p>LUGAR: <span>üó∫Ô∏è Privada Los Reyes,<br>Portal de Hierro</span></p>
    </div>

    <a id="map-link" href="#" class="location-button" target="_blank">UBICACI√ìN</a>
    <p style="font-size:.9em; color:var(--accent-purple);">Buuu!</p>
  </div>

  <!-- AUDIO de fondo desde archivo local -->
  <audio id="bgm" src="HalloweenWaltzz.mp3" preload="auto" loop></audio>

  <script>
    /* =========================
       MAPA
       ========================= */
    const LATITUD = 25.757046;
    const LONGITUD = -109.023735;
    const LUGAR_FIESTA = "Fiesta de Hugo";
    function createMapLink(lat, lng, label){
      const isApple = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      return isApple
        ? `http://maps.apple.com/?ll=${lat},${lng}&q=${encodeURIComponent(label)}&z=15`
        : `https://www.google.com/maps/search/?api=1&query=${lat},${lng}&query_place_id=${encodeURIComponent(label)}`;
    }
    document.getElementById('map-link').href = createMapLink(LATITUD, LONGITUD, LUGAR_FIESTA);

    /* =========================
       AUDIO DE FONDO (MP3)
       ========================= */
    const welcomeScreen = document.getElementById('welcome-screen');
    const invitationCardContent = document.getElementById('invitation-card-content');
    const bgm = document.getElementById('bgm');

    // Volumen inicial moderado + fade-in
    function fadeInAudio(target = 0.85, ms = 800){
      try {
        const steps = 16, stepTime = ms/steps;
        let v = 0;
        bgm.volume = 0;
        const id = setInterval(()=>{
          v += target/steps;
          bgm.volume = Math.min(v, target);
          if (v >= target) clearInterval(id);
        }, stepTime);
      } catch(e){}
    }

    // Reproducci√≥n desde el segundo 10 (una sola vez)
    let musicStarted = false;
    async function startMusicFrom10s(){
      try{
        // Si ya hay metadata, podemos fijar currentTime; si no, esperamos al evento.
        const seekAndPlay = async () => {
          try { bgm.currentTime = 10; } catch(e) {}
          await bgm.play();
          fadeInAudio(0.85, 900);
          musicStarted = true;
        };
        if (bgm.readyState >= 1){ // HAVE_METADATA
          await seekAndPlay();
        } else {
          const onMeta = async () => {
            bgm.removeEventListener('loadedmetadata', onMeta);
            await seekAndPlay();
          };
          bgm.addEventListener('loadedmetadata', onMeta);
          // Por si algunos navegadores disparan canplay primero
          const onCanPlay = async () => {
            bgm.removeEventListener('canplay', onCanPlay);
            if (!musicStarted) await seekAndPlay();
          };
          bgm.addEventListener('canplay', onCanPlay);
        }
      }catch(err){
        // Si fallara, el usuario ya hizo tap, as√≠ que un segundo intento suele funcionar
        try { await bgm.play(); } catch(e){}
      }
    }

    /* =========================
       BUZZ el√©ctrico sincronizado al parpadeo
       ========================= */
    const FLICKER_PERIOD = 1.5; // Debe coincidir con la animaci√≥n CSS
    let ctx, buzzGain, sizzleGain, humOscs = [], buzzTimer = null;

    function initBuzz(){
      if (ctx) return;
      ctx = new (window.AudioContext || window.webkitAudioContext)();

      // Mezcla principal del buzz
      buzzGain = ctx.createGain();
      buzzGain.gain.value = 0.0; // se controla con scheduleBuzzCycle
      buzzGain.connect(ctx.destination);

      // HUM (60 Hz + arm√≥nicos) con leve distorsi√≥n y filtro
      const humMix = ctx.createGain(); humMix.gain.value = 0.5;

      const MAINS = 60; // cambia a 50 si lo prefieres
      const partials = [1,2,3,4,5,6];
      partials.forEach((n, i) => {
        const osc = ctx.createOscillator();
        osc.type = (i % 2 === 0) ? 'sawtooth' : 'square';
        const pre = ctx.createGain();
        pre.gain.value = 0.08 / (i + 1);
        osc.frequency.value = MAINS * n;
        osc.detune.value = (i === 0 ? 2 : (Math.random() * 4 - 2));
        osc.connect(pre).connect(humMix);
        osc.start();
        humOscs.push(osc);
      });

      const shaper = ctx.createWaveShaper();
      const curve = new Float32Array(256);
      for (let i = 0; i < curve.length; i++){
        const x = (i / (curve.length - 1)) * 2 - 1;
        curve[i] = Math.tanh(2.2 * x);
      }
      shaper.curve = curve;
      shaper.oversample = '4x';

      const lp = ctx.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 800;

      humMix.connect(shaper).connect(lp).connect(buzzGain);

      // SIZZLE (ruido banda alta) sutil para el ‚Äúcrackle‚Äù
      const dur = 1.5;
      const buffer = ctx.createBuffer(1, ctx.sampleRate * dur, ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < data.length; i++){ data[i] = (Math.random() * 2 - 1); }
      const noise = ctx.createBufferSource();
      noise.buffer = buffer; noise.loop = true;

      const hp = ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value = 1500;
      const bp = ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value = 2800; bp.Q.value = 1.2;

      sizzleGain = ctx.createGain(); sizzleGain.gain.value = 0.018;

      noise.connect(hp).connect(bp).connect(sizzleGain).connect(buzzGain);
      noise.start();
    }

    function scheduleBuzzCycle(t0){
      if (!buzzGain) return;
      // mismos hitos que la animaci√≥n del bot√≥n
      const onMarks  = [0, 0.18, 0.22, 0.25, 0.53, 0.57, 1.00];
      const offMarks = [0.20, 0.24, 0.55];

      const ON  = 0.65;
      const OFF = 0.0;

      onMarks.forEach(p  => buzzGain.gain.setValueAtTime(ON,  t0 + p * FLICKER_PERIOD));
      offMarks.forEach(p => buzzGain.gain.setValueAtTime(OFF, t0 + p * FLICKER_PERIOD));
      buzzGain.gain.setTargetAtTime(OFF, t0 + FLICKER_PERIOD, 0.01);

      // chispazo breve al encender
      if (sizzleGain){
        const base = 0.018, snap = 0.11;
        onMarks.forEach(p => {
          const tp = t0 + p * FLICKER_PERIOD;
          sizzleGain.gain.setValueAtTime(snap, tp);
          sizzleGain.gain.setTargetAtTime(base, tp + 0.03, 0.01);
        });
      }
    }

    function startBuzzSync(){
      if (!ctx) return;
      if (!buzzTimer){
        const t0 = ctx.currentTime + 0.05;
        scheduleBuzzCycle(t0);
        buzzTimer = setInterval(()=>scheduleBuzzCycle(ctx.currentTime), FLICKER_PERIOD * 1000);
      }
    }
    function stopBuzzSync(){
      if (buzzTimer){ clearInterval(buzzTimer); buzzTimer = null; }
      if (buzzGain){ buzzGain.gain.setTargetAtTime(0.0, ctx?.currentTime ?? 0, 0.03); }
    }

    // Inicio tras el toque de bienvenida (cumple autoplay)
    welcomeScreen.addEventListener('click', async ()=>{
      welcomeScreen.style.opacity = '0';
      invitationCardContent.classList.add('show-card');
      setTimeout(()=>welcomeScreen.style.display='none', 500);

      // M√∫sica (desde 10s)
      await startMusicFrom10s();

      // Buzz
      if (!ctx) initBuzz();
      try { await ctx.resume(); } catch(e) {}
      startBuzzSync();
    }, { passive:true });

    // Manejo de visibilidad: reanudar al volver (ya hubo gesto del usuario)
    document.addEventListener('visibilitychange', async ()=>{
      if (document.hidden){
        try { if (!bgm.paused) bgm.pause(); } catch(e){}
        stopBuzzSync();
      } else {
        try { await bgm.play(); } catch(e){}
        if (ctx) { try { ctx.resume(); } catch(e){} startBuzzSync(); }
      }
    });
  </script>
</body>
</html>
