<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üéÉ Happy Halloween Birthday üßü</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Creepster&display=swap" rel="stylesheet">
  <style>
    :root{
      --dark-bg:#10001D; --accent-purple:#9D3CFF; --accent-orange:#FF8C00; --text-color:#E0E0E0;
      --font-main:'Montserrat',sans-serif; --font-title:'Creepster',cursive;
    }
    *{box-sizing:border-box}
    body{
      font-family:var(--font-main); color:var(--text-color); background-color:var(--dark-bg);
      margin:0; padding:0; display:flex; justify-content:center; align-items:center; min-height:100vh;
      overflow:hidden; position:relative;
      background-image:radial-gradient(#2a0045 40%,transparent 40%), radial-gradient(#2a0045 20%,transparent 20%);
      background-size:5px 5px; background-position:0 0, 10px 10px;
      /* Perspectiva para el efecto 3D */
      perspective: 900px;
      perspective-origin: 50% 40%;
    }
    #welcome-screen{
      position:fixed; inset:0; background-color:var(--dark-bg);
      display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000;
      cursor:pointer; transition:opacity .5s ease-out; text-align:center; padding:24px;
    }
    .portal-text{
      font-family:var(--font-title); font-size:3em; font-weight:900; color:var(--accent-orange);
      text-shadow:0 0 8px rgba(255,140,0,.7), 0 0 15px rgba(255,140,0,.5), 0 0 25px rgba(255,140,0,.3);
      margin-bottom:14px; animation:flicker 1s infinite alternate; line-height:1.1;
    }
    .portal-icon{ font-size:4em; color:var(--accent-purple); animation:pulse-icon 1.5s infinite alternate; }
    .show-card{ opacity:1 !important; transform:scale(1) rotateY(0deg) !important; }

    .invitation-card{
      width:90%; max-width:380px; min-height:600px;
      background:linear-gradient(145deg, rgba(16,0,29,.96) 0%, rgba(24,0,38,.92) 100%);
      border-radius:30px;
      padding:30px 20px; box-sizing:border-box; text-align:center; position:relative; z-index:50;
      opacity:0; transform:scale(.8) rotateY(-15deg); transition:opacity 1s ease-out, transform 1s ease-out;

      /* 3D y optimizaci√≥n */
      transform-style: preserve-3d;
      will-change: transform, box-shadow, filter;

      /* ===== Ne√≥n fijo + sombra din√°mica por variables CSS ===== */
      --dx: 0px; /* desplazamiento X (lo anima JS) */
      --dy: 0px; /* desplazamiento Y (lo anima JS) */
      box-shadow:
        var(--dx) var(--dy) 38px rgba(0,0,0,.55),    /* sombra f√≠sica que se mueve */
        0 0 22px rgba(157,60,255,.22),               /* halo suave */
        0 0 25px var(--accent-purple);               /* NE√ìN FIJO */
    }
    /* Brillo extra detr√°s (opcional) */
    .invitation-card::after{
      content:"";
      position:absolute; inset:-10px; border-radius:inherit;
      background: radial-gradient(60% 60% at 50% 50%, rgba(157,60,255,.45), transparent 60%);
      filter: blur(18px);
      z-index:-1; pointer-events:none;
    }

    h1{
      font-family:var(--font-title); font-size:3.5em; color:var(--accent-orange);
      text-shadow:0 0 10px var(--accent-orange), 0 0 20px rgba(255,140,0,.5);
      margin:10px 0 12px; line-height:1.1; transform:scale(.9); animation:title-pop .8s ease-out forwards; font-weight:900;
    }
    h2{ font-size:1.2em; font-weight:800; color:var(--accent-purple); margin:10px 0 25px; text-transform:uppercase; letter-spacing:2px; }
    p{ font-size:1em; margin:12px 0; line-height:1.5; color:var(--text-color); }

    .data-panel{
      background-color:rgba(0,0,0,.23); border:1px solid var(--accent-purple); border-radius:10px;
      padding:20px 10px; margin:26px 0; box-shadow:0 0 15px rgba(157,60,255,.25); text-align:left;
    }
    .data-panel p{ display:flex; justify-content:space-between; align-items:center; padding:6px 15px;
      border-bottom:1px dashed rgba(255,255,255,.1); font-weight:700; margin:0; }
    .data-panel p:last-child{ border-bottom:none; }
    .data-panel span{ font-weight:900; color:var(--accent-orange); text-shadow:0 0 5px rgba(255,140,0,.5); }
    .location-button{
      display:block; margin:24px auto 0; padding:16px 28px; background:var(--accent-purple); color:#fff; text-decoration:none;
      font-weight:900; border-radius:50px; box-shadow:0 0 20px var(--accent-purple); text-transform:uppercase; letter-spacing:1px;
      transition:all .3s ease; position:relative; overflow:hidden; border:none;
    }
    .location-button:hover{ background:var(--accent-orange); color:#fff; box-shadow:0 0 25px var(--accent-orange); transform:scale(1.05); }

    .effect-item{
      position:absolute; font-size:3em; opacity:.5; pointer-events:none; animation:float-and-sway 15s linear infinite;
      filter:drop-shadow(0 0 5px rgba(255,255,255,.5)); z-index:9999;
    }
    .effect-item:nth-child(1){ top:5%; left:5%; animation-duration:10s; color:var(--accent-orange); }
    .effect-item:nth-child(2){ top:25%; right:10%; animation-duration:11s; animation-delay:3s; color:var(--accent-purple); }
    .effect-item:nth-child(3){ bottom:6%; left:20%; animation-duration:12s; animation-delay:3s; color:var(--text-color); }
    .effect-item:nth-child(4){ bottom:38%; left:26%; animation-duration:13s; animation-delay:3s; color:var(--text-color); transform:rotate(-15deg); }

    @keyframes float-and-sway{
      0%{transform:translate(0,0) rotate(0deg); opacity:0}
      20%{opacity:.7}
      50%{transform:translate(10px,-20px) rotate(5deg); opacity:.9}
      80%{opacity:.7}
      100%{transform:translate(0,0) rotate(0deg); opacity:0}
    }
    @keyframes flicker{
      0%,18%,22%,25%,53%,57%,100%{opacity:1; text-shadow:0 0 8px rgba(255,140,0,.7), 0 0 15px rgba(255,140,0,.5)}
      20%,24%,55%{opacity:.6; text-shadow:none}
    }
    @keyframes pulse-icon{0%{transform:scale(1)}100%{transform:scale(1.1)}}
    @keyframes title-pop{0%{opacity:0;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
  </style>
</head>
<body>
  <!-- Portal -->
  <div id="welcome-screen" aria-label="Abrir invitaci√≥n">
    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <p style="color:#bfa6ff; margin:0 0 12px;">Toca para abrir el portal</p>
    <div class="portal-icon">üéÉ</div>
  </div>

  <!-- Tarjeta -->
  <div class="invitation-card" id="invitation-card-content">
    <span class="effect-item">ü¶á</span>
    <span class="effect-item">üéÉ</span>
    <span class="effect-item">üßü</span>
    <span class="effect-item">üëª</span>

    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <h2>Happy Halloween Birthday</h2>
    <p>¬°Acomp√°√±anos a celebrar el cumple n√∫mero 4 de Hugo, te esperamos!</p>

    <div class="data-panel">
      <p>FECHA: <span>üéÉ 30 DE OCTUBRE</span></p>
      <p>HORA: <span>üï∞Ô∏è 04:00 PM</span></p>
      <p>TIP: <span>üëª Trae tu Disfraz</span></p>
      <p>LUGAR: <span>üó∫Ô∏è Privada Los Reyes,<br>Portal de Hierro</span></p>
    </div>

    <a id="map-link" href="#" class="location-button" target="_blank" rel="noopener">UBICACI√ìN</a>
    <p style="font-size:.9em; color:#bfa6ff; margin-top:10px;">Se recomienda activar el sonido üîä</p>
  </div>

  <script>
    /* =========================
       MAPA
       ========================= */
    (function(){
      const LAT = 25.757046, LNG = -109.023735, PLACE = "Fiesta de Hugo";
      const isApple = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      const url = isApple
        ? `http://maps.apple.com/?ll=${LAT},${LNG}&q=${encodeURIComponent(PLACE)}&z=15`
        : `https://www.google.com/maps/search/?api=1&query=${LAT},${LNG}&query_place_id=${encodeURIComponent(PLACE)}`;
      const a = document.getElementById('map-link');
      if (a) a.href = url;
    })();
  </script>

  <!-- ===========================================
       AUDIO: "Toybox Spooky Waltz" (original)
       =========================================== -->
  <script>
  (() => {
    const welcomeScreen = document.getElementById('welcome-screen');
    const invitationCardContent = document.getElementById('invitation-card-content');
    if (!welcomeScreen || !invitationCardContent) return;

    let ctx, master, bus, limiter, delayA, delayB, darkLP;
    let running = false, step = 0, schedId = null, fxTimer = null;

    /* ---------- Par√°metros musicales ---------- */
    const BPM = 132;               // vals vivo (3/4)
    const BEAT = 60 / BPM;         // negra
    const STEP = BEAT / 2;         // corchea (programaci√≥n fina)
    const ROOT = 61;               // C#3
    const SCALE = [0,2,3,5,7,8,10]; // menor natural con ‚ô≠6 vibe Halloween
    const GLIDE = 0.045;

    // Envolventes
    const BASS_ENV  = {a:0.008,d:0.10,s:0.6,r:0.18};
    const LEAD_ENV  = {a:0.015,d:0.11,s:0.55,r:0.25};
    const GLOCK_ENV = {a:0.001,d:0.10,s:0.0,r:0.9};

    // Bajo "oom-pah-pah" (3/4) + colores ‚ô≠VI / v (6 compases)
    const bassRootDeg = [0,0,0, 0,0,0];
    const chordDegrees = [
      [0,3,7],
      [5,8,12],
      [7,10,14],
      [0,3,7],
      [8,10,15],
      [7,10,14]
    ];

    // Melod√≠a original (16 1/16 por comp√°s √ó 6 compases)
    const melody16ths = [
      0, 2, 3, 5,  3, 2, 0, -1,  0, 2, 5, 7,  5, 3, 2, 0,
      0, 2, 3, 5,  8, 7, 5, 3,   2, 3, 5, 7,  8, 7, 5, 3,
      0, 2, 3, 5,  3, 2, 0, -1,  0, 3, 5, 7,  10, 8, 7, 5,
      0, 2, 5, 7,  5, 3, 2, 0,  -1, 0, 2, 3,   2, 0, -1, -3,
      8, 7, 5, 3,  0, 2, 3, 5,   7, 8, 10, 8,  7, 5, 3, 2,
      0, 2, 3, 5,  3, 2, 0, -1,  0, 2, 5, 7,  5, 3, 2, 0
    ];

    /* ---------- Utils ---------- */
    const mtof = m => 440 * Math.pow(2, (m-69)/12);
    const gain = v => { const g = ctx.createGain(); g.gain.value = v ?? 0; return g; };
    const env  = (node, t0, e, peak=1, sus=0.6) => {
      node.gain.cancelScheduledValues(t0);
      node.gain.setValueAtTime(0.0001, t0);
      node.gain.linearRampToValueAtTime(peak, t0 + e.a);
      node.gain.linearRampToValueAtTime(peak*sus, t0 + e.a + e.d);
    };

    /* ---------- Audio graph ---------- */
    function init(){
      if (ctx) return;
      ctx = new (window.AudioContext || window.webkitAudioContext)();

      master = gain(0.85);
      bus    = gain(0.9);

      // Ping-pong retro + filtro suave
      delayA = ctx.createDelay(0.8); delayA.delayTime.value = 0.28;
      delayB = ctx.createDelay(0.8); delayB.delayTime.value = 0.37;
      const fbA = gain(0.28), fbB = gain(0.25);
      const panL = new StereoPannerNode(ctx,{pan:-0.18});
      const panR = new StereoPannerNode(ctx,{pan: 0.18});
      bus.connect(panL).connect(delayA).connect(fbA).connect(delayA);
      bus.connect(panR).connect(delayB).connect(fbB).connect(delayB);

      darkLP = ctx.createBiquadFilter(); darkLP.type='lowpass'; darkLP.frequency.value = 5600;
      delayA.connect(darkLP); delayB.connect(darkLP); darkLP.connect(master);

      limiter = ctx.createDynamicsCompressor();
      limiter.threshold.value=-12; limiter.knee.value=18; limiter.ratio.value=8;
      limiter.attack.value=0.003; limiter.release.value=0.2;
      master.connect(limiter).connect(ctx.destination);
    }

    /* ---------- Instrumentos ---------- */
    function playBass(time, midi, vol=0.36){
      const osc = ctx.createOscillator(); osc.type='triangle';
      const g  = gain(0); const p = new StereoPannerNode(ctx,{pan:-0.05});
      osc.frequency.setValueAtTime(mtof(midi), time);
      env(g, time, BASS_ENV, vol, 0.7);
      g.gain.setTargetAtTime(0.0001, time + BEAT*0.9, BASS_ENV.r);
      osc.connect(g).connect(p).connect(bus);
      osc.start(time); osc.stop(time + BEAT + 0.1);
    }
    function playChordStab(time, chordMidis, vol=0.18){
      chordMidis.forEach((m, i)=>{
        const osc = ctx.createOscillator();
        osc.type = (i%2===0) ? 'sawtooth' : 'square';
        const g  = gain(0); const p = new StereoPannerNode(ctx,{pan: i%2===0 ? 0.08 : -0.08});
        const vcf= ctx.createBiquadFilter(); vcf.type='lowpass'; vcf.frequency.value = 1400;
        osc.frequency.setValueAtTime(mtof(m), time);
        env(g, time, {a:0.01,d:0.15,s:0.5,r:0.2}, vol, 0.5);
        g.gain.setTargetAtTime(0.0001, time + BEAT*0.8, 0.12);
        osc.connect(g).connect(vcf).connect(p).connect(bus);
        osc.start(time); osc.stop(time + BEAT + 0.1);
      });
    }
    function playGlock(time, midi, vol=0.22){
      const s1 = ctx.createOscillator(); s1.type='sine';
      const s2 = ctx.createOscillator(); s2.type='sine';
      const g  = gain(0); const hp = ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=180;
      s1.frequency.setValueAtTime(mtof(midi), time);
      s2.frequency.setValueAtTime(mtof(midi)*2.01, time);
      env(g, time, GLOCK_ENV, vol, 0.0);
      g.gain.exponentialRampToValueAtTime(0.0001, time + 1.1);
      s1.connect(hp).connect(g).connect(bus);
      s2.connect(hp).connect(g).connect(bus);
      s1.start(time); s2.start(time);
      s1.stop(time+1.2); s2.stop(time+1.2);
    }
    function playLead(time, midi, vol=0.28){
      const o = ctx.createOscillator(); o.type='square';
      const g = gain(0); const vcf = ctx.createBiquadFilter(); vcf.type='lowpass'; vcf.frequency.value=1500;
      const p = new StereoPannerNode(ctx,{pan:0.06});
      if (playLead.lastFreq){
        o.frequency.setValueAtTime(playLead.lastFreq, time);
        o.frequency.exponentialRampToValueAtTime(mtof(midi), time + GLIDE);
      } else {
        o.frequency.setValueAtTime(mtof(midi), time);
      }
      playLead.lastFreq = mtof(midi);
      env(g, time, LEAD_ENV, vol, LEAD_ENV.s);
      const len = STEP*0.95;
      g.gain.setTargetAtTime(0.0001, time + len, LEAD_ENV.r);
      o.connect(g).connect(vcf).connect(p).connect(bus);
      o.start(time); o.stop(time + len + LEAD_ENV.r + 0.05);
    }
    function playTheremin(time, startMidi, endMidi, dur=1.8, vol=0.18){
      const o = ctx.createOscillator(); o.type='sine';
      const g = gain(0); const p = new StereoPannerNode(ctx,{pan:0.1});
      env(g, time, {a:0.2,d:0.2,s:0.7,r:0.5}, vol, 0.7);
      o.frequency.setValueAtTime(mtof(startMidi), time);
      o.frequency.linearRampToValueAtTime(mtof(endMidi), time + dur*0.7);
      g.gain.exponentialRampToValueAtTime(0.0001, time + dur);
      o.connect(g).connect(p).connect(bus);
      o.start(time); o.stop(time + dur + 0.1);
    }

    /* ---------- Secuenciador (6 compases en bucle) ---------- */
    function startSeq(){
      if (running) return; running = true;
      let next = ctx.currentTime + 0.06;
      const lookAhead = 0.1, horizon = 0.25;

      function loop(){
        while (next < ctx.currentTime + horizon){
          const sixBarLen = 6;
          const bar = Math.floor((step * STEP) / (BEAT*3)) % sixBarLen; // 3/4
          const posInBar = ((step * STEP) % (BEAT*3)) / BEAT;           // en negras

          // 1: bajo
          if (Math.abs(posInBar - 0) < 0.001){
            const deg = bassRootDeg[bar];
            const rootMidi = ROOT + SCALE[(deg % SCALE.length + SCALE.length) % SCALE.length];
            playBass(next, rootMidi);
          }
          // 2 y 3: stabs de acorde
          if (Math.abs(posInBar - 1) < 0.001 || Math.abs(posInBar - 2) < 0.001){
            const chord = chordDegrees[bar].map(d => ROOT + d);
            playChordStab(next, chord);
          }
          // Glockenspiel (motivo)
          if (step % 2 === 0){
            const idx = (bar*16) + ((step/2)%16|0);
            const degOff = melody16ths[idx % melody16ths.length];
            const scaleIdx = ((degOff % SCALE.length) + SCALE.length) % SCALE.length;
            const midi = (ROOT + 12) + SCALE[scaleIdx];
            playGlock(next, midi);
          }
          // Lead a contratiempo
          if ([0.5, 1.5, 2.5].some(v => Math.abs(posInBar - v) < 0.001)){
            const idx = (bar*16) + ((step)%16);
            const degOff = melody16ths[idx % melody16ths.length] + (bar===4 ? 2 : 0);
            const scaleIdx = ((degOff % SCALE.length) + SCALE.length) % SCALE.length;
            const midi = (ROOT + 12) + SCALE[scaleIdx];
            playLead(next, midi);
          }
          // Theremin en comp√°s 3 y 6
          if (Math.abs(posInBar - 0) < 0.001 && (bar === 2 || bar === 5)){
            playTheremin(next + 0.05, ROOT+SCALE[0]+12, ROOT+SCALE[3]+19, 1.6, 0.14);
          }

          next += STEP;
          step++;
        }
        schedId = setTimeout(loop, lookAhead*1000);
      }
      loop();

      // FX tipo ‚Äúmusic box‚Äù cada ~9‚Äì14 s
      const fxLoop = () => {
        const t = ctx.currentTime + 0.2;
        [0,3,7,12].forEach((d,i)=>{ playGlock(t + i*0.12, ROOT + d + 24, 0.18); });
        fxTimer = setTimeout(fxLoop, 9000 + Math.random()*5000);
      };
      fxLoop();
    }

    function stopSeq(){
      running = false;
      if (schedId){ clearTimeout(schedId); schedId = null; }
      if (fxTimer){ clearTimeout(fxTimer); fxTimer = null; }
      step = 0;
    }

    /* ---------- UI / Inicio ---------- */
    welcomeScreen.addEventListener('click', async ()=>{
      // Mostrar tarjeta
      welcomeScreen.style.opacity = '0';
      invitationCardContent.classList.add('show-card');
      setTimeout(()=>welcomeScreen.style.display='none', 500);

      // Audio
      if (!ctx) init();
      try{ await ctx.resume(); }catch(e){}
      startSeq();
      portalHit();

      // Activar parallax tras la animaci√≥n de entrada
      setTimeout(enableParallax3D, 600);
    }, { passive:true });

    // Impacto breve al abrir
    function portalHit(){
      const t = ctx.currentTime + 0.02;
      const o = ctx.createOscillator(); o.type='square';
      const a = gain(0); const bp = ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=600; bp.Q.value=2.2;
      o.frequency.setValueAtTime(200,t); o.frequency.exponentialRampToValueAtTime(70,t+0.3);
      env(a,t,{a:0.01,d:0.07,s:0,r:0.28},0.7,0); a.gain.exponentialRampToValueAtTime(0.0001,t+0.34);
      o.connect(bp).connect(a).connect(bus); o.start(t); o.stop(t+0.36);
    }

    // Ahorro bater√≠a
    document.addEventListener('visibilitychange', ()=>{
      if (!ctx) return;
      if (document.hidden){ stopSeq(); }
      else if (!running){ startSeq(); }
    });

    // Controles consola (opcionales)
    window.__toy_spooky = {
      tempo(bpm){ stopSeq(); const beat = 60/bpm; /* si quieres recalcular, av√≠same y lo dejo din√°mico */ startSeq(); },
      dark(hz){ darkLP && darkLP.frequency.setTargetAtTime(hz, ctx.currentTime, .3); }, // 3k‚Äì7k
      wet(v){ bus && bus.gain.setTargetAtTime(v, ctx.currentTime, .2); },               // 0..1
      master(v){ master && (master.gain.value=v); }
    };

    /* =====================================================
       EFECTO 3D / PARALLAX (m√≥vil + mouse fallback)
       ===================================================== */
    function enableParallax3D(){
      const card = document.getElementById('invitation-card-content');
      if (!card) return;

      const MAX_RX = 8;   // ‚Üë/‚Üì
      const MAX_RY = 12;  // ‚Üê/‚Üí
      const SMOOTH = 0.12;
      const RESTORE_MS = 160;

      let targetRX = 0, targetRY = 0;
      let currentRX = 0, currentRY = 0;
      let rafId = null;

      function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

      function applyStyle(rx, ry){
        // Rotaci√≥n 3D
        card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) scale(1)`;
        // Actualizamos SOLO variables CSS para la sombra, preservando el ne√≥n
        const shadowX = (-ry * 1.2).toFixed(1) + 'px';
        const shadowY = (rx * 1.2).toFixed(1) + 'px';
        card.style.setProperty('--dx', shadowX);
        card.style.setProperty('--dy', shadowY);

        // Brillo sutil seg√∫n inclinaci√≥n
        const tiltAmt = Math.min(1, (Math.abs(rx)/MAX_RX + Math.abs(ry)/MAX_RY)/2);
        const contrast = 1 + tiltAmt*0.05;
        const brightness = 1 + tiltAmt*0.02;
        card.style.filter = `brightness(${brightness}) contrast(${contrast})`;
      }

      function animate(){
        currentRX += (targetRX - currentRX) * SMOOTH;
        currentRY += (targetRY - currentRY) * SMOOTH;
        applyStyle(currentRX, currentRY);
        rafId = requestAnimationFrame(animate);
      }

      function settleBack(){
        const startRX = currentRX, startRY = currentRY;
        const start = performance.now();
        function step(t){
          const k = Math.min(1, (t - start)/RESTORE_MS);
          const ease = 1 - Math.pow(1 - k, 3);
          targetRX = startRX * (1 - ease);
          targetRY = startRY * (1 - ease);
          if (k < 1) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
      }

      async function tryEnableDO(){
        const D = window.DeviceOrientationEvent || window.DeviceMotionEvent;
        if (D && typeof D.requestPermission === 'function'){
          try{
            const res = await D.requestPermission();
            if (res !== 'granted') return false;
          }catch{ return false; }
        }
        window.addEventListener('deviceorientation', (e)=>{
          const beta = e.beta ?? 0;   // X
          const gamma = e.gamma ?? 0; // Y
          const rx = clamp((beta / 30) * MAX_RX, -MAX_RX, MAX_RX);
          const ry = clamp((gamma / 25) * MAX_RY, -MAX_RY, MAX_RY);
          targetRX = rx; targetRY = ry;
        }, true);
        return true;
      }

      function enableMouse(){
        const rect = card.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        function onMove(ev){
          const x = ev.clientX ?? (ev.touches?.[0]?.clientX || cx);
          const y = ev.clientY ?? (ev.touches?.[0]?.clientY || cy);
          const dx = (x - cx) / (rect.width/2);
          const dy = (y - cy) / (rect.height/2);
          targetRY = clamp(dx * MAX_RY, -MAX_RY, MAX_RY);
          targetRX = clamp(-dy * MAX_RX, -MAX_RX, MAX_RX);
        }
        window.addEventListener('mousemove', onMove, { passive:true });
        window.addEventListener('touchmove', onMove, { passive:true });
      }

      (async ()=>{
        const ok = await tryEnableDO();
        if (!ok) enableMouse();
        if (!rafId) animate();
      })();

      // Reposo al cambiar de pesta√±a y doble tap para centrar
      document.addEventListener('visibilitychange', ()=>{ if (document.hidden) settleBack(); });
      let lastTap=0;
      card.addEventListener('click', ()=>{
        const now = Date.now();
        if (now - lastTap < 300) settleBack();
        lastTap = now;
      }, { passive:true });
    }
  })();
  </script>
</body>
</html>
