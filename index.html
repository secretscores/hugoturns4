<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üéÉ Happy Halloween Birthday üßü</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Creepster&display=swap" rel="stylesheet">
  <style>
    :root{
      --dark-bg:#1A002C; --accent-purple:#9D3CFF; --accent-orange:#FF8C00; --text-color:#E0E0E0;
      --font-main:'Montserrat',sans-serif; --font-title:'Creepster',cursive;
    }
    body{
      font-family:var(--font-main); color:var(--text-color); background-color:var(--dark-bg);
      margin:0; padding:0; display:flex; justify-content:center; align-items:center; min-height:100vh;
      overflow:hidden; position:relative;
      background-image:radial-gradient(#300050 40%,transparent 40%), radial-gradient(#300050 20%,transparent 20%);
      background-size:5px 5px; background-position:0 0, 10px 10px;
    }
    #welcome-screen{
      position:fixed; inset:0; background-color:var(--dark-bg);
      display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000;
      cursor:pointer; transition:opacity .5s ease-out;
    }
    .portal-text{
      font-family:var(--font-title); font-size:3em; font-weight:700; color:var(--accent-orange);
      text-shadow:0 0 8px rgba(255,140,0,.7), 0 0 15px rgba(255,140,0,.5), 0 0 25px rgba(255,140,0,.3);
      margin-bottom:20px; animation:flicker 1s infinite alternate; line-height:1.1;
    }
    .portal-icon{ font-size:4em; color:var(--accent-purple); animation:pulse-icon 1.5s infinite alternate; }
    .invitation-card{
      width:90%; max-width:380px; min-height:600px;
      background:linear-gradient(145deg, rgba(26,0,44,.95) 0%, rgba(32,0,48,.9) 100%);
      border-radius:30px; box-shadow:0 15px 50px rgba(0,0,0,.7), 0 0 25px var(--accent-purple);
      padding:30px 20px; box-sizing:border-box; text-align:center; position:relative; z-index:50;
      opacity:0; transform:scale(.8) rotateY(-15deg); transition:opacity 1s ease-out, transform 1s ease-out;
    }
    h1{
      font-family:var(--font-title); font-size:3.5em; color:var(--accent-orange);
      text-shadow:0 0 10px var(--accent-orange), 0 0 20px rgba(255,140,0,.5);
      margin-bottom:15px; line-height:1.1; transform:scale(.9); animation:title-pop .8s ease-out forwards; font-weight:900;
    }
    @keyframes title-pop{0%{opacity:0;transform:scale(.5)}100%{opacity:1;transform:scale(1)}}
    h2{ font-size:1.2em; font-weight:700; color:var(--accent-purple); margin:10px 0 25px; text-transform:uppercase; letter-spacing:2px; }
    p{ font-size:1em; margin:15px 0; line-height:1.5; color:var(--text-color); }
    .data-panel{
      background-color:rgba(0,0,0,.2); border:1px solid var(--accent-purple); border-radius:10px;
      padding:20px 10px; margin:30px 0; box-shadow:0 0 15px rgba(157,60,255,.3); text-align:left;
    }
    .data-panel p{ display:flex; justify-content:space-between; align-items:center; padding:5px 15px;
      border-bottom:1px dashed rgba(255,255,255,.1); font-weight:700; }
    .data-panel p:last-child{ border-bottom:none; }
    .data-panel span{ font-weight:900; color:var(--accent-orange); text-shadow:0 0 5px rgba(255,140,0,.5); }
    .location-button{
      display:block; margin:30px auto; padding:18px 30px; background:var(--accent-purple); color:#fff; text-decoration:none;
      font-weight:900; border-radius:50px; box-shadow:0 0 20px var(--accent-purple); text-transform:uppercase; letter-spacing:1px;
      transition:all .3s ease; position:relative; overflow:hidden; border:none;
    }
    .location-button:hover{ background:var(--accent-orange); color:#fff; box-shadow:0 0 25px var(--accent-orange); transform:scale(1.05); }
    .effect-item{
      position:absolute; font-size:3em; opacity:.5; pointer-events:none; animation:float-and-sway 15s linear infinite;
      filter:drop-shadow(0 0 5px rgba(255,255,255,.5)); z-index:9999;
    }
    .effect-item:nth-child(1){ top:5%; left:5%; animation-duration:10s; color:var(--accent-orange); }
    .effect-item:nth-child(2){ top:25%; right:10%; animation-duration:11s; animation-delay:3s; color:var(--accent-purple); }
    .effect-item:nth-child(3){ bottom:6%; left:20%; animation-duration:12s; animation-delay:3s; color:var(--text-color); }
    .effect-item:nth-child(4){ bottom:38%; left:26%; animation-duration:13s; animation-delay:3s; color:var(--text-color); transform:rotate(-15deg); }
    @keyframes float-and-sway{
      0%{transform:translate(0,0) rotate(0deg); opacity:0}
      20%{opacity:.7}
      50%{transform:translate(10px,-20px) rotate(5deg); opacity:.9}
      80%{opacity:.7}
      100%{transform:translate(0,0) rotate(0deg); opacity:0}
    }
    @keyframes flicker{
      0%,18%,22%,25%,53%,57%,100%{opacity:1; text-shadow:0 0 8px rgba(255,140,0,.7), 0 0 15px rgba(255,140,0,.5)}
      20%,24%,55%{opacity:.6; text-shadow:none}
    }
    @keyframes pulse-icon{0%{transform:scale(1)}100%{transform:scale(1.1)}}
    .show-card{ opacity:1 !important; transform:scale(1) rotateY(0deg) !important; }
  </style>
</head>
<body>
  <div id="welcome-screen">
    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <p>¬øEst√°n listos?...</p>
    <div class="portal-icon">üéÉ</div>
    <p class="small-instruction" style="margin-top:50px; color:var(--accent-purple);">Toca la pantalla para abrir el portal</p>
  </div>

  <!-- Tarjeta -->
  <div class="invitation-card" id="invitation-card-content">
    <span class="effect-item">ü¶á</span>
    <span class="effect-item">üéÉ</span>
    <span class="effect-item">üßü</span>
    <span class="effect-item">üëª</span>

    <h1 class="portal-text">HUGO TURNS 4!</h1>
    <h2>Happy Halloween Birthday</h2>
    <p>¬°Acomp√°√±anos a celebrar el cumple n√∫mero 4 de Hugo, te esperamos!</p>

    <div class="data-panel">
      <p>FECHA: <span>üéÉ 30 DE OCTUBRE</span></p>
      <p>HORA: <span>üï∞Ô∏è 04:00 PM</span></p>
      <p>TIP: <span>üëª Trae tu Disfraz</span></p>
      <p>LUGAR: <span>üó∫Ô∏è Privada Los Reyes,<br>Portal de Hierro</span></p>
    </div>

    <a id="map-link" href="#" class="location-button" target="_blank">UBICACI√ìN</a>
    <p style="font-size:.9em; color:var(--accent-purple);">Buuu!</p>
  </div>

  <script>
    /* =========================
       CONFIG MAPA
       ========================= */
    const LATITUD = 25.757046;
    const LONGITUD = -109.023735;
    const LUGAR_FIESTA = "Fiesta de Hugo";
    function createMapLink(lat, lng, label){
      const isApple = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      return isApple
        ? `http://maps.apple.com/?ll=${lat},${lng}&q=${encodeURIComponent(label)}&z=15`
        : `https://www.google.com/maps/search/?api=1&query=${lat},${lng}&query_place_id=${encodeURIComponent(label)}`;
    }
    const mapLink = document.getElementById('map-link');
    mapLink.href = createMapLink(LATITUD, LONGITUD, LUGAR_FIESTA);

    /* =========================
       WEB AUDIO: NE√ìN + PASOS
       ========================= */
    let ctx, master, limiter;
    let neonGate, neonHumGain, crackleTimer, gateTimer, stepsTimer;
    let running = false;

    // ‚¨áÔ∏è Ajustes r√°pidos
    const HUM_BASE = 60;          // 60 Hz (zumbido el√©ctrico)
    const HUM_LEVEL = 0.14;       // volumen base del zumbido
    const GATE_MIN = 0.25;        // ganancia m√≠nima del parpadeo (ne√≥n)
    const GATE_MAX = 0.95;        // ganancia m√°xima del parpadeo
    const GATE_RATE_MS = [25, 45]; // intervalo aleatorio entre cambios (ms) => parpadeo r√°pido
    const CRACKLE_EVERY_MS = [120, 420]; // aleatorio entre chispazos
    const CRACKLE_DUR = [0.012, 0.045];  // duraci√≥n de chispazos (12‚Äì45 ms)
    const CRACKLE_HP = 2800;      // filtro paso alto para chispa

    // Pasos:
    const STEPS_TRIGGER_EVERY = 2000; // disparar patr√≥n cada 2 s
    const STEPS_PATTERN_DUR = 3.0;    // el patr√≥n dura 3 s
    const STEP_SPACING = 0.6;         // separaci√≥n entre pisadas
    const STEP_COUNT = Math.floor(STEPS_PATTERN_DUR / STEP_SPACING); // n¬∫ pisadas en patr√≥n

    function rand(min, max){ return Math.random()*(max-min)+min; }
    function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function initAudio(){
      if (ctx) return;
      ctx = new (window.AudioContext || window.webkitAudioContext)();

      // Master
      master = ctx.createGain();
      master.gain.setValueAtTime(0.8, ctx.currentTime);

      limiter = ctx.createDynamicsCompressor();
      limiter.threshold.value = -14;
      limiter.knee.value = 20;
      limiter.ratio.value = 12;
      limiter.attack.value = 0.003;
      limiter.release.value = 0.15;

      master.connect(limiter).connect(ctx.destination);

      // Puerta/compresor para simular parpadeo global (control de neon)
      neonGate = ctx.createGain();
      neonGate.gain.value = 0.0;
      neonGate.connect(master);

      // Zumbido base (arm√≥nicos 60/120/180 Hz)
      neonHumGain = ctx.createGain();
      neonHumGain.gain.value = HUM_LEVEL;
      neonHumGain.connect(neonGate);

      [1,2,3].forEach(mult=>{
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        gain.gain.value = 0.22 / mult; // arm√≥nicos decrecientes
        osc.type = (mult === 1) ? 'sawtooth' : 'square';
        osc.frequency.value = HUM_BASE * mult;
        // Liger√≠sima inestabilidad de frecuencia (jitter)
        setInterval(()=>{
          const now = ctx.currentTime;
          osc.frequency.linearRampToValueAtTime(HUM_BASE*mult*(1+rand(-0.002,0.002)), now + 0.08);
        }, 120);
        osc.connect(gain).connect(neonHumGain);
        osc.start();
      });

      startNeonFlicker();
      startCrackles();
      startStepsLoop();
    }

    // ---------- PARPADEO (gate) ----------
    function startNeonFlicker(){
      if (gateTimer) return;
      const apply = ()=>{
        const g = rand(GATE_MIN, GATE_MAX);
        const t = ctx.currentTime;
        neonGate.gain.cancelScheduledValues(t);
        neonGate.gain.setTargetAtTime(g, t, 0.015);
        const next = rand(GATE_RATE_MS[0], GATE_RATE_MS[1]);
        gateTimer = setTimeout(apply, next);
      };
      apply();
    }
    function stopNeonFlicker(){ if (gateTimer){ clearTimeout(gateTimer); gateTimer=null; } }

    // ---------- CHISPAZOS ----------
    function noiseBuffer(){
      const len = Math.floor(ctx.sampleRate * 0.1);
      const buf = ctx.createBuffer(1, len, ctx.sampleRate);
      const data = buf.getChannelData(0);
      for (let i=0; i<len; i++){ data[i] = (Math.random()*2-1) * (1 - i/len); } // peque√±a ca√≠da
      return buf;
    }
    const _noiseBufCache = { buf:null };
    function crackle(){
      if (!_noiseBufCache.buf) _noiseBufCache.buf = noiseBuffer();
      const src = ctx.createBufferSource();
      src.buffer = _noiseBufCache.buf;
      const hp = ctx.createBiquadFilter();
      hp.type = 'highpass';
      hp.frequency.value = CRACKLE_HP;
      hp.Q.value = 0.7;

      const g = ctx.createGain();
      const now = ctx.currentTime;
      const dur = rand(CRACKLE_DUR[0], CRACKLE_DUR[1]);

      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(rand(0.2,0.55), now + 0.002);
      g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

      src.connect(hp).connect(g).connect(neonGate);
      src.start(now);
      src.stop(now + dur + 0.02);
    }
    function startCrackles(){
      if (crackleTimer) return;
      const loop = ()=>{
        crackle();
        const next = rand(CRACKLE_EVERY_MS[0], CRACKLE_EVERY_MS[1]);
        crackleTimer = setTimeout(loop, next);
      };
      loop();
    }
    function stopCrackles(){ if (crackleTimer){ clearTimeout(crackleTimer); crackleTimer=null; } }

    // ---------- PASOS ----------
    function playStep(atTime, panVal=0){
      // Golpe grave (tal√≥n)
      const kickOsc = ctx.createOscillator();
      kickOsc.type = 'sine';
      kickOsc.frequency.setValueAtTime(120, atTime);
      kickOsc.frequency.exponentialRampToValueAtTime(55, atTime + 0.12);

      const kickGain = ctx.createGain();
      kickGain.gain.setValueAtTime(0.0001, atTime);
      kickGain.gain.exponentialRampToValueAtTime(0.85, atTime + 0.01);
      kickGain.gain.exponentialRampToValueAtTime(0.0001, atTime + 0.22);

      // Frota/ropa (ruido filtrado)
      if (!_noiseBufCache.buf) _noiseBufCache.buf = noiseBuffer();
      const src = ctx.createBufferSource();
      src.buffer = _noiseBufCache.buf;

      const bp = ctx.createBiquadFilter();
      bp.type = 'bandpass';
      bp.frequency.value = 2200;
      bp.Q.value = 2.5;

      const noiseGain = ctx.createGain();
      noiseGain.gain.setValueAtTime(0.0001, atTime);
      noiseGain.gain.linearRampToValueAtTime(0.25, atTime + 0.02);
      noiseGain.gain.exponentialRampToValueAtTime(0.0001, atTime + 0.15);

      const pan = new StereoPannerNode(ctx, { pan: panVal });

      kickOsc.connect(kickGain).connect(pan).connect(master);
      src.connect(bp).connect(noiseGain).connect(pan).connect(master);

      kickOsc.start(atTime);
      kickOsc.stop(atTime + 0.25);

      src.start(atTime);
      src.stop(atTime + 0.2);
    }

    function scheduleFootsteps(startAt, durSec){
      // Alterna izquierda/derecha, ligeras variaciones
      for (let i=0; i<STEP_COUNT; i++){
        const t = startAt + i*STEP_SPACING + rand(-0.03, 0.03);
        const pan = (i % 2 === 0) ? -0.18 : 0.18;
        playStep(t, pan + rand(-0.05, 0.05));
      }
    }

    function startStepsLoop(){
      if (stepsTimer) return;
      const tick = ()=>{
        const t0 = ctx.currentTime + 0.05;
        scheduleFootsteps(t0, STEPS_PATTERN_DUR);
        stepsTimer = setTimeout(tick, STEPS_TRIGGER_EVERY);
      };
      tick();
    }
    function stopStepsLoop(){ if (stepsTimer){ clearTimeout(stepsTimer); stepsTimer=null; } }

    // ---------- CONTROL ----------
    function startSoundscape(){
      if (running) return;
      running = true;
      initAudio();
    }
    function stopSoundscape(){
      running = false;
      stopNeonFlicker(); stopCrackles(); stopStepsLoop();
    }

    // ---------- UI ----------
    const welcomeScreen = document.getElementById('welcome-screen');
    const invitationCardContent = document.getElementById('invitation-card-content');

    welcomeScreen.addEventListener('click', async () => {
      // Transici√≥n UI
      welcomeScreen.style.opacity = '0';
      invitationCardContent.classList.add('show-card');
      setTimeout(()=>welcomeScreen.style.display='none', 500);

      // Audio
      if (!ctx) initAudio();
      try{ await ctx.resume(); }catch(e){}
      startSoundscape();
      // Impacto breve al abrir
      playPortalHit();
    });

    // Impacto de apertura (breve)
    function playPortalHit(){
      const t0 = ctx.currentTime + 0.02;
      const osc = ctx.createOscillator();
      const amp = ctx.createGain();
      const bp = ctx.createBiquadFilter();
      bp.type = 'bandpass';
      bp.frequency.setValueAtTime(700, t0);
      bp.Q.value = 3;

      osc.type = 'square';
      osc.frequency.setValueAtTime(240, t0);
      osc.frequency.exponentialRampToValueAtTime(70, t0 + 0.28);

      amp.gain.setValueAtTime(0, t0);
      amp.gain.linearRampToValueAtTime(0.8, t0 + 0.02);
      amp.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.35);

      osc.connect(bp).connect(amp).connect(master);
      osc.start(t0);
      osc.stop(t0 + 0.38);
    }

    // Ahorro de bater√≠a / foco
    document.addEventListener('visibilitychange', ()=>{
      if (!ctx) return;
      if (document.hidden){ stopSoundscape(); }
      else if (!running){ startSoundscape(); }
    });

    // Exponer knobs r√°pidos en consola
    window.__neon = {
      setHumLevel:(v)=>{ if (neonHumGain) neonHumGain.gain.setTargetAtTime(v, ctx.currentTime, 0.05); },
      setGate:(min,max)=>{ window.GATE_MIN=min; window.GATE_MAX=max; }, // visual; cambia alcance del parpadeo
    };
  </script>
</body>
</html>
